{% extends "base.html" %}

{% block title %}Randevu Sistemi - DoƒüustanSosyal{% endblock %}
{% block page_title %}Randevu Sistemi{% endblock %}
{% block page_subtitle %}√ñƒüretmenlerinle kolayca randevu al!{% endblock %}

{% block extra_styles %}
<style>
    .appointment-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
    }

    .appointments-list {
        background: white;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    /* Tabs */
    .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
        border-bottom: 2px solid #f0f0f0;
    }

    .tab-btn {
        padding: 12px 24px;
        background: transparent;
        border: none;
        border-bottom: 3px solid transparent;
        color: #718096;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        bottom: -2px;
    }

    .tab-btn:hover {
        color: #e74c3c;
    }

    .tab-btn.active {
        color: #e74c3c;
        border-bottom-color: #e74c3c;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .create-appointment {
        background: white;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .section-title {
        font-size: 22px;
        font-weight: 600;
        color: #333;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .appointment-card {
        background: linear-gradient(135deg, #e74c3c15 0%, #c0392b15 100%);
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 15px;
        border-left: 4px solid #e74c3c;
        position: relative;
    }

    .appointment-instructor {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
    }

    .appointment-info {
        display: flex;
        flex-direction: column;
        gap: 8px;
        font-size: 14px;
        color: #666;
    }

    .appointment-info-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .appointment-status {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        margin-top: 10px;
    }

    .status-pending {
        background: #fff3cd;
        color: #856404;
    }

    .status-approved {
        background: #d4edda;
        color: #155724;
    }

    .status-rejected {
        background: #f8d7da;
        color: #721c24;
    }

    .status-canceled {
        background: #e2e3e5;
        color: #383d41;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 500;
        font-size: 14px;
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.3s;
        background: #f8f9fa;
    }

    .form-control:focus {
        outline: none;
        border-color: #e74c3c;
        background: white;
        box-shadow: 0 0 0 4px rgba(231, 76, 60, 0.1);
    }

    select.form-control {
        cursor: pointer;
    }

    textarea.form-control {
        resize: vertical;
        min-height: 100px;
    }

    .btn-create {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
    }

    .btn-create:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.5);
    }

    .btn-cancel {
        width: 48%;
        padding: 10px;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 10px;
    }

    .btn-cancel:hover {
        background: #c0392b;
        transform: translateY(-2px);
    }

    .btn-remove {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 30px;
        height: 30px;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        line-height: 1;
        padding: 0;
    }

    .btn-remove:hover {
        background: #c0392b;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.5);
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #999;
    }

    .empty-state-icon {
        font-size: 48px;
        margin-bottom: 15px;
    }

    @media (max-width: 768px) {
        .appointment-container {
            grid-template-columns: 1fr;
        }

        .appointments-list {
            order: 2;
        }

        .create-appointment {
            order: 1;
        }

        .tabs {
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 120px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="appointment-container">
    <div class="appointments-list">
        <h2 class="section-title">Randevularƒ±m</h2>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="aktif" type="button">Aktif Randevular</button>
            <button class="tab-btn" data-tab="gecmis" type="button">Ge√ßmi≈ü Randevular</button>
        </div>

        <!-- Aktif Randevular Tab -->
        <div id="aktif" class="tab-content active">
            {% if aktif_randevular %}
                {% for randevu in aktif_randevular %}
                <div class="appointment-card">
                    {% if randevu.durum == 'reddedildi' %}
                    <form method="POST" action="{% url 'randevu-sistemi' %}" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="archive">
        <input type="hidden" name="randevu_id" value="{{ randevu.id }}">
                        <button type="submit" class="btn-remove" title="Ge√ßmi≈üe Ta≈üƒ±">√ó</button>
                    </form>
                    {% endif %}
                    <div class="appointment-instructor">{{ randevu.ogretmen.unvan }} {{ randevu.ogretmen.kullanici.get_full_name }}</div>
                    <div class="appointment-info">
                        <div class="appointment-info-item">
                            <strong>Tarih:</strong> {{ randevu.tarih|date:"d F Y, l" }}
                        </div>
                        <div class="appointment-info-item">
                            <strong>Saat:</strong> {{ randevu.baslangic_saati|time:"H:i" }} - {{ randevu.bitis_saati|time:"H:i" }}
                        </div>
                        {% if randevu.ogretmen.ofis %}
                        <div class="appointment-info-item">
                            <strong>Yer:</strong> {{ randevu.ogretmen.ofis }}
                        </div>
                        {% endif %}
                        <div class="appointment-info-item">
                            <strong>Konu:</strong> {{ randevu.konu }}
                        </div>
                        {% if randevu.aciklama %}
                        <div class="appointment-info-item" style="margin-top: 10px; color: #666;">
                            {{ randevu.aciklama }}
                        </div>
                        {% endif %}
                    </div>
                    <span class="appointment-status {% if randevu.durum == 'onaylandi' %}status-approved{% elif randevu.durum == 'reddedildi' %}status-rejected{% else %}status-pending{% endif %}">
                        {% if randevu.durum == 'onaylandi' %}Onaylandƒ±
                        {% elif randevu.durum == 'reddedildi' %}Reddedildi
                        {% else %}Beklemede{% endif %}
                    </span>
                    {% if randevu.durum == 'bekliyor' or randevu.durum == 'onaylandi' %}
                    <br>
                    <form method="POST" action="{% url 'randevu-sistemi' %}" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="cancel">
                        <input type="hidden" name="randevu_id" value="{{ randevu.id }}">
                        <button type="submit" class="btn-cancel" onclick="return confirm('Bu randevuyu iptal etmek istediƒüinize emin misiniz?')">ƒ∞ptal Et</button>
                    </form>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üìÖ</div>
                    <p>Hen√ºz aktif randevunuz bulunmuyor</p>
                </div>
            {% endif %}
        </div>

        <!-- Ge√ßmi≈ü Randevular Tab -->
        <div id="gecmis" class="tab-content">
            {% if gecmis_randevular %}
                {% for randevu in gecmis_randevular %}
                <div class="appointment-card" style="opacity: 0.7;">
                    <div class="appointment-instructor">{{ randevu.ogretmen.unvan }} {{ randevu.ogretmen.kullanici.get_full_name }}</div>
                    <div class="appointment-info">
                        <div class="appointment-info-item">
                            <strong>Tarih:</strong> {{ randevu.tarih|date:"d F Y, l" }}
                        </div>
                        <div class="appointment-info-item">
                            <strong>Saat:</strong> {{ randevu.baslangic_saati|time:"H:i" }} - {{ randevu.bitis_saati|time:"H:i" }}
                        </div>
                        <div class="appointment-info-item">
                            <strong>Konu:</strong> {{ randevu.konu }}
                        </div>
                    </div>
                    <span class="appointment-status {% if randevu.durum == 'iptal' %}status-canceled{% elif randevu.durum == 'onaylandi' %}status-approved{% elif randevu.durum == 'reddedildi' %}status-rejected{% else %}status-pending{% endif %}">
                        {% if randevu.durum == 'iptal' %}ƒ∞ptal Edildi
                        {% elif randevu.durum == 'onaylandi' %}Tamamlandƒ±
                        {% elif randevu.durum == 'reddedildi' %}Reddedildi
                        {% else %}Beklemede{% endif %}
                    </span>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üïê</div>
                    <p>Ge√ßmi≈ü randevu kaydƒ± bulunmuyor</p>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="create-appointment">
        <h2 class="section-title">Yeni Randevu Olu≈ütur</h2>
        
        <form method="POST" action="{% url 'randevu-sistemi' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="create">
            
            <div class="form-group">
                <label class="form-label" for="ogretmen">√ñƒüretim G√∂revlisi</label>
                <select name="ogretmen" id="ogretmen" class="form-control" required>
                    <option value="">Se√ßiniz...</option>
                    {% for ogretmen in ogretmenler %}
                    <option value="{{ ogretmen.id }}">{{ ogretmen.unvan }} {{ ogretmen.kullanici.get_full_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="tarih">Tarih</label>
                <input type="date" name="tarih" id="tarih" class="form-control" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="baslangic_saati">Ba≈ülangƒ±√ß Saati</label>
                <input type="time" name="baslangic_saati" id="baslangic_saati" class="form-control" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="bitis_saati">Biti≈ü Saati</label>
                <input type="time" name="bitis_saati" id="bitis_saati" class="form-control" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="konu">Konu</label>
                <input type="text" name="konu" id="konu" class="form-control" placeholder="G√∂r√º≈üme konusu..." required>
            </div>

            <div class="form-group">
                <label class="form-label" for="aciklama">A√ßƒ±klama (ƒ∞steƒüe Baƒülƒ±)</label>
                <textarea name="aciklama" id="aciklama" class="form-control" placeholder="Detaylƒ± a√ßƒ±klama..." rows="3"></textarea>
            </div>

            <button type="submit" class="btn-create">Randevu Talebi Olu≈ütur</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Script loaded');
        
        // Tab switching with data attribute
        const tabButtons = document.querySelectorAll('.tab-btn');
        console.log('Found buttons:', tabButtons.length);
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                console.log('Clicked tab:', targetTab);
                
                // Remove active from all buttons and contents
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Add active to clicked button and corresponding content
                this.classList.add('active');
                const targetContent = document.getElementById(targetTab);
                if (targetContent) {
                    targetContent.classList.add('active');
                    console.log('Activated:', targetTab);
                } else {
                    console.error('Content not found:', targetTab);
                }
            });
        });
        
        // Minimum tarih olarak bug√ºn√º ayarla
        const tarihInput = document.getElementById('tarih');
        if (tarihInput) {
            tarihInput.min = new Date().toISOString().split('T')[0];
        }
        
        // Biti≈ü saati ba≈ülangƒ±√ß saatinden sonra olmalƒ±
        const baslangicInput = document.getElementById('baslangic_saati');
        const bitisInput = document.getElementById('bitis_saati');
        if (baslangicInput && bitisInput) {
            baslangicInput.addEventListener('change', function() {
                const baslangic = this.value;
                bitisInput.min = baslangic;
            });
        }
    });
</script>
{% endblock %}